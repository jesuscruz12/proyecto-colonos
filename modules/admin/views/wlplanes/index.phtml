<main class="app-main page-planes">
  <!-- ======= Encabezado ======= -->
  <div class="app-content-header">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col-sm-6">
          <h3 class="mb-0">Planes</h3>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-end mb-0">
            <li class="breadcrumb-item"><a href="<?php echo BASE_URL; ?>">Inicio</a></li>
            <li class="breadcrumb-item active" aria-current="page">Planes</li>
          </ol>
        </div>
      </div>

      <!-- Toolbar rápida -->
      <div class="row mt-2">
        <div class="col-12">
          <form id="frm_toolbar" class="d-flex flex-wrap gap-2 justify-content-start justify-content-lg-end">
            <div class="input-group" style="max-width:220px">
              <span class="input-group-text"><i class="bi bi-currency-dollar"></i></span>
              <input type="number" class="form-control" id="price_min" placeholder="Precio mín." min="0" step="0.01">
            </div>
            <div class="input-group" style="max-width:220px">
              <span class="input-group-text"><i class="bi bi-currency-dollar"></i></span>
              <input type="number" class="form-control" id="price_max" placeholder="Precio máx." min="0" step="0.01">
            </div>

            <div class="input-group" style="max-width:220px">
              <span class="input-group-text"><i class="bi bi-people"></i></span>
              <select id="f_tipo_producto" class="form-select">
                <option value="">Tipo (todos)</option>
                <option value="1">B2B</option>
                <option value="3">B2C</option>
                <option value="2">Otro</option>
              </select>
            </div>

            <div class="input-group" style="max-width:220px">
              <span class="input-group-text"><i class="bi bi-toggle-on"></i></span>
              <select id="f_estatus" class="form-select">
                <option value="">Estatus (todos)</option>
                <option value="1">Activo</option>
                <option value="2">Inactivo</option>
              </select>
            </div>

            <button type="button" id="btn_toolbar_aplicar" class="btn btn-primary">
              <i class="bi bi-check2-circle me-1"></i> Aplicar
            </button>
            <!--<button type="button" id="btn_toolbar_limpiar" class="btn btn-outline-secondary">
              Limpiar
            </button> -->
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- ======= Contenido ======= -->
  <div class="app-content">
    <div class="container-fluid">

      <!-- KPIs -->
      <div class="row g-3">
        <div class="col-12 col-sm-6 col-xl-3">
          <div class="info-box shadow-sm">
            <span class="info-box-icon bg-primary"><i class="bi bi-grid-3x3-gap"></i></span>
            <div class="info-box-content">
              <span class="info-box-text text-muted">Total planes</span>
              <span class="info-box-number fs-5 fw-semibold" id="kpi_total">—</span>
            </div>
          </div>
        </div>
        <div class="col-12 col-sm-6 col-xl-3">
          <div class="info-box shadow-sm">
            <span class="info-box-icon bg-success"><i class="bi bi-toggle-on"></i></span>
            <div class="info-box-content">
              <span class="info-box-text text-muted">Activos</span>
              <span class="info-box-number fs-5 fw-semibold" id="kpi_activos">—</span>
            </div>
          </div>
        </div>
        <div class="col-12 col-sm-6 col-xl-3">
          <div class="info-box shadow-sm">
            <span class="info-box-icon bg-info"><i class="bi bi-cash-coin"></i></span>
            <div class="info-box-content">
              <span class="info-box-text text-muted">Precio promedio</span>
              <span class="info-box-number fs-5 fw-semibold" id="kpi_promedio">—</span>
            </div>
          </div>
        </div>
        <div class="col-12 col-sm-6 col-xl-3">
          <div class="info-box shadow-sm">
            <span class="info-box-icon bg-warning"><i class="bi bi-hash"></i></span>
            <div class="info-box-content">
              <span class="info-box-text text-muted">Con RRSS ilimitadas</span>
              <span class="info-box-number fs-5 fw-semibold" id="kpi_rrss">—</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Filtros -->
      <div class="card mt-3">
        <div class="card-header">
          <h3 class="card-title mb-0"><i class="bi bi-funnel me-1"></i> Filtros</h3>
        </div>
        <div class="card-body">
          <form id="frm_filtros" class="row g-3 align-items-end">
            <div class="col-12 col-md-6 col-lg-4">
              <label for="f_nombre" class="form-label">Nombre comercial</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-card-text"></i></span>
                <input type="text" class="form-control" id="f_nombre" placeholder="Ej. Plan 10 GB">
              </div>
              <div class="form-text">&nbsp;</div>
            </div>

            <div class="col-6 col-md-3 col-lg-2">
              <label for="f_vigencia" class="form-label">Vigencia (días)</label>
              <select id="f_vigencia" class="form-select">
                <option value="">Todas</option>
                <option value="7">7</option>
                <option value="15">15</option>
                <option value="30">30</option>
                <option value="60">60</option>
                <option value="90">90</option>
              </select>
              <div class="form-text">&nbsp;</div>
            </div>

            <div class="col-6 col-md-3 col-lg-2">
              <label for="f_compartir" class="form-label">Comparte datos</label>
              <select id="f_compartir" class="form-select">
                <option value="">Todos</option>
                <option value="1">Sí</option>
                <option value="0">No</option>
              </select>
              <div class="form-text">&nbsp;</div>
            </div>

            <div class="col-6 col-md-3 col-lg-2">
              <label for="f_ticket" class="form-label">Ticket</label>
              <select id="f_ticket" class="form-select">
                <option value="">Todos</option>
                <option value="SI">Sí</option>
                <option value="NO">No</option>
              </select>
              <div class="form-text">&nbsp;</div>
            </div>

            <div class="col-6 col-md-3 col-lg-2">
              <label for="f_rrss" class="form-label">RRSS</label>
              <select id="f_rrss" class="form-select">
                <option value="">Todas</option>
                <option value="ILIMITADAS">Ilimitadas</option>
                <option value="LIMITADAS">Limitadas</option>
                <option value="NO">No incluidas</option>
              </select>
              <div class="form-text">&nbsp;</div>
            </div>

            <div class="col-12 col-md-12 col-lg-2 d-grid d-sm-flex gap-2">
              <button type="button" id="btn_aplicar_filtros" class="btn btn-primary w-100" data-bs-toggle="tooltip" title="Aplicar filtros">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Listado -->
      <div class="card">
        <div class="card-header d-flex align-items-center">
          <h3 class="card-title mb-0"><i class="bi bi-table me-1"></i> Listado</h3>

          <div class="ms-auto d-flex gap-2">
            <button class="btn btn-outline-secondary btn-sm" id="btn_recargar"
              data-bs-toggle="tooltip" title="Limpiar filtros y recargar datos">
              <i class="bi bi-arrow-repeat"></i>
            </button>

            <?php if (Session::get('rol') == ADMINISTRADOR || (Session::get('permisos')['planes.crear'] ?? false)) : ?>
              <button class="btn btn-primary btn-sm extend-new-recurso" data-bs-toggle="modal" data-bs-target="#modal-crear">
                <i class="fas fa-plus-circle me-1"></i> Nuevo
              </button>
            <?php endif; ?>
          </div>
        </div>

        <div class="card-body">
          <div class="table-responsive">
            <table id="planes-table" class="table table-striped table-bordered w-100 align-middle">
              <thead>
                <tr class="align-middle">
                  <th>#</th>
                  <th>Nombre</th>
                  <th>Precio</th>
                  <th>Vigencia</th>
                  <th>Datos</th>
                  <th>Voz</th>
                  <th>SMS</th>
                  <th>RRSS</th>
                  <th>Tipo</th>
                  <th>Act/Rec</th>
                  <th>Estatus</th>
                  <th>Comparte</th>
                  <th>OfferingId</th>
                  <th>Precio LikePhone</th>
                  <th style="width:120px;" class="dt-actions">Acciones</th>
                </tr>
              </thead>
              <tbody></tbody>
              <tfoot>
                <tr>
                  <th></th>
                  <th>Nombre</th>
                  <th>Precio</th>
                  <th>Vigencia</th>
                  <th>Datos</th>
                  <th>Voz</th>
                  <th>SMS</th>
                  <th>RRSS</th>
                  <th>Tipo</th>
                  <th>Act/Rec</th>
                  <th>Estatus</th>
                  <th>Comparte</th>
                  <th>OfferingId</th>
                  <th>Precio LikePhone</th>
                  <th></th>
                </tr>
              </tfoot>
            </table>
          </div>
          <div class="small text-muted mt-2">
            Tip: usa la caja “Buscar” o los filtros de arriba. Mantén <kbd>Shift</kbd> para ordenar por múltiples columnas.
          </div>
        </div>
      </div>

    </div>
  </div>
</main>

<!-- ======= Modal: CREAR ======= -->
<div class="modal fade" id="modal-crear" tabindex="-1" aria-labelledby="crearModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered mx-auto">
    <div class="modal-content border-0 shadow">
      <form id="frm_nuevo" method="post" class="m-0">
        <div class="card card-primary card-outline mb-0">
          <div class="card-header">
            <h5 class="card-title mb-0" id="crearModalLabel">
              <i class="bi bi-plus-circle me-1"></i> Crear plan
            </h5>
            <button type="button" class="btn btn-sm btn-outline-secondary float-end" data-bs-dismiss="modal">Cerrar</button>
          </div>

          <div class="card-body">
            <input type="hidden" name="csrf_token" value="<?php echo Session::get('tokencsrf'); ?>">

            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label for="nombre_comercial" class="form-label">Nombre comercial</label>
                <input type="text" class="form-control" name="nombre_comercial" id="nombre_comercial" required maxlength="255">
              </div>

              <div class="col-6 col-md-3">
                <label for="precio" class="form-label">Precio (cliente)</label>
                <input type="number" class="form-control" name="precio" id="precio" min="0" step="0.01" required>
              </div>

              <div class="col-6 col-md-3">
                <label for="precio_likephone_wl" class="form-label">Precio LikePhone</label>
                <input type="text" class="form-control" name="precio_likephone_wl" id="precio_likephone_wl" maxlength="100" placeholder="Opcional">
              </div>

              <div class="col-6 col-md-3">
                <label for="tipo_producto" class="form-label">Tipo (B2B/B2C)</label>
                <select class="form-select" name="tipo_producto" id="tipo_producto">
                  <option value="1" selected>B2B</option>
                  <option value="3">B2C</option>
                  <option value="2">Otro</option>
                </select>
              </div>

              <div class="col-6 col-md-3">
                <label for="primar_secundaria" class="form-label">Act/Rec</label>
                <select class="form-select" name="primar_secundaria" id="primar_secundaria">
                  <option value="1">Activación</option>
                  <option value="2">Recarga</option>
                </select>
              </div>

              <div class="col-6 col-md-3">
                <label for="vigencia" class="form-label">Vigencia</label>
                <input type="text" class="form-control" name="vigencia" id="vigencia" maxlength="200" placeholder="Ej. 30 días">
              </div>

              <div class="col-12 col-md-6">
                <label for="offeringId" class="form-label">OfferingId</label>
                <input type="text" class="form-control" name="offeringId" id="offeringId" maxlength="200" placeholder="ID en BSS/Altán">
              </div>

              <div class="col-12 col-md-6">
                <label for="datos" class="form-label">Datos</label>
                <input type="text" class="form-control" name="datos" id="datos" maxlength="200" placeholder="Ej. 10 GB">
              </div>

              <div class="col-6 col-md-3">
                <label for="voz" class="form-label">Voz</label>
                <input type="text" class="form-control" name="voz" id="voz" maxlength="200" placeholder="Ej. Ilimitada">
              </div>

              <div class="col-6 col-md-3">
                <label for="sms" class="form-label">SMS</label>
                <input type="text" class="form-control" name="sms" id="sms" maxlength="200" placeholder="Ej. Ilimitados">
              </div>

              <div class="col-12 col-md-6">
                <label for="rrss" class="form-label">RRSS</label>
                <input type="text" class="form-control" name="rrss" id="rrss" placeholder="Ej. FB/IG/TikTok ilimitados">
              </div>

              <div class="col-6 col-md-3">
                <label for="ticket" class="form-label">Ticket</label>
                <input type="text" class="form-control" name="ticket" id="ticket" placeholder="Ej. Sí / No">
              </div>

              <div class="col-6 col-md-3">
                <label for="comparte_datos" class="form-label">Comparte datos</label>
                <select class="form-select" name="comparte_datos" id="comparte_datos">
                  <option value="1">Sí</option>
                  <option value="0">No</option>
                </select>
              </div>

              <div class="col-6 col-md-3">
                <label for="estatus_paquete" class="form-label">Estatus</label>
                <select class="form-select" name="estatus_paquete" id="estatus_paquete">
                  <option value="1">Activo</option>
                  <option value="2">Inactivo</option>
                </select>
              </div>

              <!-- Imágenes -->
              <div class="col-12">
                <div class="row g-3">
                  <div class="col-12 col-md-6">
                    <label for="imagen_web1" class="form-label">Imagen Web 1</label>
                    <input type="text" class="form-control" name="imagen_web1" id="imagen_web1" placeholder="URL o ruta">
                  </div>
                  <div class="col-12 col-md-6">
                    <label for="imagen_web2" class="form-label">Imagen Web 2</label>
                    <input type="text" class="form-control" name="imagen_web2" id="imagen_web2" placeholder="URL o ruta">
                  </div>
                  <div class="col-12 col-md-6">
                    <label for="imagen_movil1" class="form-label">Imagen Móvil 1</label>
                    <input type="text" class="form-control" name="imagen_movil1" id="imagen_movil1" placeholder="URL o ruta">
                  </div>
                  <div class="col-12 col-md-6">
                    <label for="imagen_movil2" class="form-label">Imagen Móvil 2</label>
                    <input type="text" class="form-control" name="imagen_movil2" id="imagen_movil2" placeholder="URL o ruta">
                  </div>
                </div>
              </div>
            </div>

            <div class="text-center mt-3">
              <div class="spinner-border text-primary" role="status" style="display:none;">
                <span class="visually-hidden">Procesando...</span>
              </div>
            </div>
          </div>

          <div class="card-footer d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-save me-1"></i> Guardar
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ======= Modal: EDITAR ======= -->
<div class="modal fade" id="modal-editar" tabindex="-1" aria-labelledby="editarModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered mx-auto">
    <div class="modal-content border-0 shadow">
      <form id="frm_editar" method="post" class="m-0">
        <div class="card card-warning card-outline mb-0">
          <div class="card-header">
            <h5 class="card-title mb-0" id="editarModalLabel">
              <i class="bi bi-pencil-square me-1"></i> Editar plan
            </h5>
            <button type="button" class="btn btn-sm btn-outline-secondary float-end" data-bs-dismiss="modal">Cerrar</button>
          </div>

          <div class="card-body">
            <input type="hidden" name="csrf_token" value="<?php echo Session::get('tokencsrf'); ?>">
            <input type="hidden" name="cv_plan" id="cv_plan_editar">

            <div class="row g-3">
              <!-- Mismos campos con sufijo _editar -->
              <div class="col-12 col-md-6">
                <label for="nombre_comercial_editar" class="form-label">Nombre comercial</label>
                <input type="text" class="form-control" name="nombre_comercial" id="nombre_comercial_editar" required maxlength="255">
              </div>

              <div class="col-6 col-md-3">
                <label for="precio_editar" class="form-label">Precio (cliente)</label>
                <input type="number" class="form-control" name="precio" id="precio_editar" min="0" step="0.01" required>
              </div>

              <div class="col-6 col-md-3">
                <label for="precio_likephone_wl_editar" class="form-label">Precio LikePhone</label>
                <input type="text" class="form-control" name="precio_likephone_wl" id="precio_likephone_wl_editar" maxlength="100">
              </div>

              <div class="col-6 col-md-3">
                <label for="tipo_producto_editar" class="form-label">Tipo (B2B/B2C)</label>
                <select class="form-select" name="tipo_producto" id="tipo_producto_editar">
                  <option value="1">B2B</option>
                  <option value="3">B2C</option>
                  <option value="2">Otro</option>
                </select>
              </div>

              <div class="col-6 col-md-3">
                <label for="primar_secundaria_editar" class="form-label">Act/Rec</label>
                <select class="form-select" name="primar_secundaria" id="primar_secundaria_editar">
                  <option value="1">Activación</option>
                  <option value="2">Recarga</option>
                </select>
              </div>

              <div class="col-6 col-md-3">
                <label for="vigencia_editar" class="form-label">Vigencia</label>
                <input type="text" class="form-control" name="vigencia" id="vigencia_editar" maxlength="200">
              </div>

              <div class="col-12 col-md-6">
                <label for="offeringId_editar" class="form-label">OfferingId</label>
                <input type="text" class="form-control" name="offeringId" id="offeringId_editar" maxlength="200">
              </div>

              <div class="col-12 col-md-6">
                <label for="datos_editar" class="form-label">Datos</label>
                <input type="text" class="form-control" name="datos" id="datos_editar" maxlength="200">
              </div>

              <div class="col-6 col-md-3">
                <label for="voz_editar" class="form-label">Voz</label>
                <input type="text" class="form-control" name="voz" id="voz_editar" maxlength="200">
              </div>

              <div class="col-6 col-md-3">
                <label for="sms_editar" class="form-label">SMS</label>
                <input type="text" class="form-control" name="sms" id="sms_editar" maxlength="200">
              </div>

              <div class="col-12 col-md-6">
                <label for="rrss_editar" class="form-label">RRSS</label>
                <input type="text" class="form-control" name="rrss" id="rrss_editar">
              </div>

              <div class="col-6 col-md-3">
                <label for="ticket_editar" class="form-label">Ticket</label>
                <input type="text" class="form-control" name="ticket" id="ticket_editar">
              </div>

              <div class="col-6 col-md-3">
                <label for="comparte_datos_editar" class="form-label">Comparte datos</label>
                <select class="form-select" name="comparte_datos" id="comparte_datos_editar">
                  <option value="1">Sí</option>
                  <option value="0">No</option>
                </select>
              </div>

              <div class="col-6 col-md-3">
                <label for="estatus_paquete_editar" class="form-label">Estatus</label>
                <select class="form-select" name="estatus_paquete" id="estatus_paquete_editar">
                  <option value="1">Activo</option>
                  <option value="2">Inactivo</option>
                </select>
              </div>

              <!-- Imágenes -->
              <div class="col-12">
                <div class="row g-3">
                  <div class="col-12 col-md-6">
                    <label for="imagen_web1_editar" class="form-label">Imagen Web 1</label>
                    <input type="text" class="form-control" name="imagen_web1" id="imagen_web1_editar">
                  </div>
                  <div class="col-12 col-md-6">
                    <label for="imagen_web2_editar" class="form-label">Imagen Web 2</label>
                    <input type="text" class="form-control" name="imagen_web2" id="imagen_web2_editar">
                  </div>
                  <div class="col-12 col-md-6">
                    <label for="imagen_movil1_editar" class="form-label">Imagen Móvil 1</label>
                    <input type="text" class="form-control" name="imagen_movil1" id="imagen_movil1_editar">
                  </div>
                  <div class="col-12 col-md-6">
                    <label for="imagen_movil2_editar" class="form-label">Imagen Móvil 2</label>
                    <input type="text" class="form-control" name="imagen_movil2" id="imagen_movil2_editar">
                  </div>
                </div>
              </div>
            </div>

            <div class="text-center mt-3">
              <div class="spinner-border text-warning" role="status" style="display:none;">
                <span class="visually-hidden">Procesando...</span>
              </div>
            </div>
          </div>

          <div class="card-footer d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-warning">
              <i class="bi bi-check2-square me-1"></i> Actualizar
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
